rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Allow users to read and create posts
    match /posts/{postId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if request.auth.uid == resource.data.userId;
    }
    
    // Allow authenticated users to report posts
    match /reports/{reportId} {
      allow create: if request.auth != null 
        && request.resource.data.reporterId == request.auth.uid
        && request.resource.data.keys().hasAll(['id', 'postId', 'reporterId', 'reporterName', 'reason', 'timestamp']);
      allow read: if false;  // Only admins should read reports (managed through backend)
    }
  }
}